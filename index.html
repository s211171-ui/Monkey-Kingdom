<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>手机贪吃蛇 | 经典游戏</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        food: '#EF4444',
                        snake: '#10B981',
                        dark: '#111827',
                        light: '#F9FAFB',
                        grid: '#374151'
                    },
                    fontFamily: {
                        game: ['"Press Start 2P"', 'cursive'],
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .game-container {
                position: relative;
                width: 100%;
                max-width: 450px;
                margin: 0 auto;
                padding: 0 15px;
            }
            
            .snake-grid {
                display: grid;
                grid-template-columns: repeat(var(--grid-cols), 1fr);
                grid-template-rows: repeat(var(--grid-rows), 1fr);
                gap: 1px;
                background-color: theme('colors.grid');
                border-radius: 8px;
                overflow: hidden;
                touch-action: none;
                aspect-ratio: 1/1;
            }
            
            .grid-cell {
                background-color: theme('colors.dark');
                transition: all 0.05s ease;
            }
            
            .snake-cell {
                background-color: theme('colors.snake');
                border-radius: 3px;
                transform: scale(0.9);
                box-shadow: 0 0 6px rgba(16, 185, 129, 0.5);
            }
            
            .snake-head {
                background-color: #059669;
                transform: scale(0.95);
                border-radius: 4px;
            }
            
            .food-cell {
                background-color: theme('colors.food');
                border-radius: 50%;
                transform: scale(0.8);
                box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
                animation: pulse 1.2s infinite alternate;
            }
            
            .direction-pad {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
                width: 100%;
                max-width: 300px;
                margin: 25px auto 0;
            }
            
            .dir-btn {
                aspect-ratio: 1/1;
                border-radius: 12px;
                background-color: rgba(59, 130, 246, 0.2);
                border: 2px solid theme('colors.primary');
                color: white;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                transition: all 0.15s ease;
                font-size: 2rem;
                touch-action: manipulation;
            }
            
            .dir-btn:active {
                background-color: theme('colors.primary');
                transform: scale(0.92);
                box-shadow: 0 0 12px rgba(59, 130, 246, 0.6);
            }
            
            .game-overlay {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(17, 24, 39, 0.95);
                backdrop-filter: blur(4px);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                border-radius: 8px;
                z-index: 10;
                padding: 20px;
            }
            
            .score-card {
                background-color: rgba(255, 255, 255, 0.08);
                border-radius: 12px;
                padding: 15px 25px;
                margin-bottom: 20px;
                text-align: center;
                backdrop-filter: blur(2px);
            }
            
            .btn-primary {
                background-color: theme('colors.primary');
                color: white;
                border-radius: 12px;
                padding: 14px 30px;
                font-weight: 600;
                font-size: 1.1rem;
                transition: all 0.2s ease;
                border: none;
                touch-action: manipulation;
            }
            
            .btn-primary:active {
                transform: scale(0.95);
                box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            }
            
            .difficulty-btn {
                padding: 10px 20px;
                border-radius: 8px;
                background-color: rgba(255, 255, 255, 0.08);
                color: white;
                transition: all 0.2s ease;
                border: 2px solid transparent;
            }
            
            .difficulty-btn.active {
                background-color: theme('colors.primary');
                border-color: theme('colors.primary');
                transform: scale(1.05);
            }
            
            @keyframes pulse {
                0% { transform: scale(0.8); opacity: 0.8; }
                100% { transform: scale(0.9); opacity: 1; }
            }
            
            @keyframes slideIn {
                0% { transform: translateY(20px); opacity: 0; }
                100% { transform: translateY(0); opacity: 1; }
            }
            
            .animate-slide-in {
                animation: slideIn 0.4s ease forwards;
            }
            
            .animate-fade-in {
                animation: fadeIn 0.5s ease forwards;
            }
            
            @keyframes fadeIn {
                0% { opacity: 0; }
                100% { opacity: 1; }
            }
        }
    </style>
    
    <!-- 引入像素字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-dark to-gray-900 min-h-screen text-light font-sans pt-6 pb-16">
    <header class="text-center mb-6 animate-fade-in">
        <h1 class="text-[clamp(1.5rem,5vw,2rem)] font-game text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary mb-2">
            贪吃蛇
        </h1>
        <p class="text-gray-400 text-sm max-w-xs mx-auto">
            滑动屏幕或点击方向键控制蛇移动
        </p>
    </header>
    
    <main class="game-container">
        <!-- 游戏信息栏 -->
        <div class="flex justify-between items-center mb-4 p-3 bg-gray-800/50 rounded-xl animate-fade-in" style="animation-delay: 0.1s">
            <div class="text-center">
                <p class="text-gray-400 text-xs mb-1">分数</p>
                <p id="score" class="text-xl font-bold text-secondary">0</p>
            </div>
            
            <div class="flex gap-2">
                <button id="startBtn" class="btn-primary px-4 py-2 text-sm">
                    <i class="fa fa-play mr-1"></i>开始
                </button>
                <button id="pauseBtn" class="btn-primary px-4 py-2 text-sm bg-gray-700 hidden">
                    <i class="fa fa-pause mr-1"></i>暂停
                </button>
            </div>
            
            <div class="text-center">
                <p class="text-gray-400 text-xs mb-1">最高分</p>
                <p id="highScore" class="text-xl font-bold text-primary">0</p>
            </div>
        </div>
        
        <!-- 游戏网格 -->
        <div id="gameGrid" class="snake-grid shadow-lg animate-fade-in" style="animation-delay: 0.2s"></div>
        
        <!-- 开始游戏界面 -->
        <div id="startOverlay" class="game-overlay animate-slide-in">
            <h2 class="text-[clamp(1.5rem,4vw,2rem)] font-game text-primary mb-8">贪吃蛇</h2>
            
            <div class="w-full max-w-xs mb-8">
                <h3 class="text-lg font-medium mb-4 text-gray-300 text-center">选择难度</h3>
                <div class="flex gap-3 justify-center">
                    <button class="difficulty-btn active" data-speed="200">简单</button>
                    <button class="difficulty-btn" data-speed="150">中等</button>
                    <button class="difficulty-btn" data-speed="100">困难</button>
                </div>
            </div>
            
            <button id="startGameBtn" class="btn-primary">
                <i class="fa fa-play mr-2"></i>开始游戏
            </button>
            
            <p class="mt-8 text-gray-400 text-sm text-center">
                点击方向键控制蛇移动<br>吃到食物获得分数
            </p>
        </div>
        
        <!-- 游戏结束界面 -->
        <div id="gameOverOverlay" class="game-overlay hidden animate-slide-in">
            <h2 class="text-[clamp(1.5rem,4vw,2rem)] font-game text-food mb-4">游戏结束!</h2>
            
            <div class="score-card w-full max-w-xs mb-8">
                <p class="text-gray-300 text-sm mb-2">最终得分</p>
                <p id="finalScore" class="text-3xl font-bold text-food">0</p>
                
                <div class="border-t border-gray-700 my-4 pt-4">
                    <p class="text-gray-300 text-sm mb-2">最高分</p>
                    <p id="finalHighScore" class="text-2xl font-bold text-primary">0</p>
                </div>
            </div>
            
            <button id="restartBtn" class="btn-primary">
                <i class="fa fa-refresh mr-2"></i>再来一局
            </button>
        </div>
    </main>
    
    <!-- 方向键控制区 -->
    <div class="direction-pad mt-8 animate-fade-in" style="animation-delay: 0.3s">
        <div></div>
        <button class="dir-btn" data-direction="up">
            <i class="fa fa-chevron-up"></i>
        </button>
        <div></div>
        <button class="dir-btn" data-direction="left">
            <i class="fa fa-chevron-left"></i>
        </button>
        <div></div>
        <button class="dir-btn" data-direction="right">
            <i class="fa fa-chevron-right"></i>
        </button>
        <div></div>
        <button class="dir-btn" data-direction="down">
            <i class="fa fa-chevron-down"></i>
        </button>
        <div></div>
    </div>
    
    <footer class="text-center text-gray-500 text-xs mt-12 animate-fade-in" style="animation-delay: 0.4s">
        <p>© 2025 手机贪吃蛇 | 专为移动设备优化</p>
    </footer>

    <script>
        // 游戏配置
        const config = {
            gridSize: 15, // 15x15网格，适合手机屏幕
            initialSpeed: 200, // 初始速度（毫秒/步）
            directions: {
                up: { x: 0, y: -1 },
                down: { x: 0, y: 1 },
                left: { x: -1, y: 0 },
                right: { x: 1, y: 0 }
            }
        };
        
        // 游戏状态
        let gameState = {
            snake: [],
            food: {},
            direction: config.directions.right,
            nextDirection: config.directions.right,
            isRunning: false,
            isPaused: false,
            score: 0,
            highScore: 0,
            speed: config.initialSpeed,
            gridSize: config.gridSize,
            gameLoop: null
        };
        
        // DOM元素
        const gameGrid = document.getElementById('gameGrid');
        const startOverlay = document.getElementById('startOverlay');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const restartBtn = document.getElementById('restartBtn');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const finalScoreElement = document.getElementById('finalScore');
        const finalHighScoreElement = document.getElementById('finalHighScore');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        const directionBtns = document.querySelectorAll('.dir-btn');
        
        // 初始化游戏
        function initGame() {
            // 设置网格大小
            gameGrid.style.setProperty('--grid-cols', gameState.gridSize);
            gameGrid.style.setProperty('--grid-rows', gameState.gridSize);
            
            // 创建网格单元格
            gameGrid.innerHTML = '';
            for (let y = 0; y < gameState.gridSize; y++) {
                for (let x = 0; x < gameState.gridSize; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    gameGrid.appendChild(cell);
                }
            }
            
            // 加载最高分
            loadHighScore();
            
            // 添加事件监听
            setupEventListeners();
        }
        
        // 设置事件监听
        function setupEventListeners() {
            // 方向键控制
            directionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const direction = btn.dataset.direction;
                    changeDirection(direction);
                });
            });
            
            // 滑动控制（额外支持滑动手势）
            let touchStartX = 0;
            let touchStartY = 0;
            
            gameGrid.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            gameGrid.addEventListener('touchend', (e) => {
                if (!gameState.isRunning || gameState.isPaused) return;
                
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                
                const deltaX = touchEndX - touchStartX;
                const deltaY = touchEndY - touchStartY;
                
                // 判断滑动方向（优先水平滑动）
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    if (deltaX > 30 && gameState.direction !== config.directions.left) {
                        changeDirection('right');
                    } else if (deltaX < -30 && gameState.direction !== config.directions.right) {
                        changeDirection('left');
                    }
                } else {
                    if (deltaY > 30 && gameState.direction !== config.directions.up) {
                        changeDirection('down');
                    } else if (deltaY < -30 && gameState.direction !== config.directions.down) {
                        changeDirection('up');
                    }
                }
            }, { passive: true });
            
            // 难度选择
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    difficultyBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    gameState.speed = parseInt(btn.dataset.speed);
                });
            });
            
            // 按钮事件
            startBtn.addEventListener('click', startGame);
            pauseBtn.addEventListener('click', togglePause);
            startGameBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', restartGame);
        }
        
        // 开始游戏
        function startGame() {
            // 重置游戏状态
            resetGame();
            
            // 隐藏覆盖层，显示暂停按钮
            startOverlay.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');
            startBtn.classList.add('hidden');
            pauseBtn.classList.remove('hidden');
            
            // 开始游戏循环
            gameState.isRunning = true;
            gameState.isPaused = false;
            startGameLoop();
            
            // 蛇出现动画
            setTimeout(() => {
                gameState.snake.forEach((segment, index) => {
                    setTimeout(() => {
                        const cell = document.querySelector(`[data-x="${segment.x}"][data-y="${segment.y}"]`);
                        if (cell) {
                            cell.classList.add('snake-cell');
                            if (index === 0) cell.classList.add('snake-head');
                        }
                    }, index * 50);
                });
            }, 100);
        }
        
        // 重置游戏
        function resetGame() {
            // 清除之前的游戏循环
            if (gameState.gameLoop) {
                clearInterval(gameState.gameLoop);
            }
            
            // 重置分数
            gameState.score = 0;
            updateScoreDisplay();
            
            // 初始化蛇的位置（居中）
            const centerX = Math.floor(gameState.gridSize / 2);
            const centerY = Math.floor(gameState.gridSize / 2);
            
            gameState.snake = [
                { x: centerX, y: centerY },
                { x: centerX - 1, y: centerY },
                { x: centerX - 2, y: centerY }
            ];
            
            // 初始方向
            gameState.direction = config.directions.right;
            gameState.nextDirection = config.directions.right;
            
            // 生成食物
            generateFood();
            
            // 更新游戏网格
            updateGameGrid();
        }
        
        // 开始游戏循环
        function startGameLoop() {
            gameState.gameLoop = setInterval(() => {
                if (!gameState.isPaused) {
                    moveSnake();
                }
            }, gameState.speed);
        }
        
        // 移动蛇
        function moveSnake() {
            // 更新方向
            gameState.direction = gameState.nextDirection;
            
            // 计算新的蛇头位置
            const head = { ...gameState.snake[0] };
            head.x += gameState.direction.x;
            head.y += gameState.direction.y;
            
            // 检测碰撞
            if (checkCollision(head)) {
                endGame();
                return;
            }
            
            // 将新蛇头添加到蛇的前面
            gameState.snake.unshift(head);
            
            // 检查是否吃到食物
            if (head.x === gameState.food.x && head.y === gameState.food.y) {
                // 吃到食物，加分并生成新食物
                gameState.score += 10;
                updateScoreDisplay();
                generateFood();
                
                // 食物被吃动画
                const foodCell = document.querySelector(`[data-x="${gameState.food.x}"][data-y="${gameState.food.y}"]`);
                if (foodCell) {
                    foodCell.style.transform = 'scale(1.3)';
                    foodCell.style.opacity = '0';
                    setTimeout(() => {
                        if (foodCell) {
                            foodCell.style.transform = '';
                            foodCell.style.opacity = '';
                        }
                    }, 100);
                }
            } else {
                // 没吃到食物，移除蛇尾
                const tail = gameState.snake.pop();
                const tailCell = document.querySelector(`[data-x="${tail.x}"][data-y="${tail.y}"]`);
                if (tailCell) {
                    tailCell.classList.remove('snake-cell', 'snake-head');
                }
            }
            
            // 更新蛇头和身体
            const headCell = document.querySelector(`[data-x="${head.x}"][data-y="${head.y}"]`);
            if (headCell) {
                // 移除之前的蛇头样式
                const oldHeadCell = document.querySelector(`[data-x="${gameState.snake[1].x}"][data-y="${gameState.snake[1].y}"]`);
                if (oldHeadCell) {
                    oldHeadCell.classList.remove('snake-head');
                }
                
                // 添加新蛇头样式
                headCell.classList.add('snake-cell', 'snake-head');
            }
        }
        
        // 检测碰撞
        function checkCollision(head) {
            // 边界碰撞
            if (
                head.x < 0 || 
                head.x >= gameState.gridSize || 
                head.y < 0 || 
                head.y >= gameState.gridSize
            ) {
                return true;
            }
            
            // 自身碰撞
            for (let i = 1; i < gameState.snake.length; i++) {
                if (head.x === gameState.snake[i].x && head.y === gameState.snake[i].y) {
                    return true;
                }
            }
            
            return false;
        }
        
        // 生成食物
        function generateFood() {
            let foodX, foodY;
            let isOnSnake;
            
            // 确保食物不在蛇身上
            do {
                isOnSnake = false;
                foodX = Math.floor(Math.random() * gameState.gridSize);
                foodY = Math.floor(Math.random() * gameState.gridSize);
                
                // 检查食物是否在蛇身上
                for (let i = 0; i < gameState.snake.length; i++) {
                    if (gameState.snake[i].x === foodX && gameState.snake[i].y === foodY) {
                        isOnSnake = true;
                        break;
                    }
                }
            } while (isOnSnake);
            
            gameState.food = { x: foodX, y: foodY };
            
            // 更新食物显示
            updateFoodDisplay();
        }
        
        // 更新游戏网格
        function updateGameGrid() {
            // 清除所有单元格状态
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('snake-cell', 'food-cell', 'snake-head');
            });
            
            // 更新蛇的位置
            gameState.snake.forEach((segment, index) => {
                const cell = document.querySelector(`[data-x="${segment.x}"][data-y="${segment.y}"]`);
                if (cell) {
                    cell.classList.add('snake-cell');
                    if (index === 0) {
                        cell.classList.add('snake-head');
                    }
                }
            });
            
            // 更新食物位置
            updateFoodDisplay();
        }
        
        // 更新食物显示
        function updateFoodDisplay() {
            const foodCell = document.querySelector(`[data-x="${gameState.food.x}"][data-y="${gameState.food.y}"]`);
            if (foodCell) {
                foodCell.classList.add('food-cell');
                
                // 食物出现动画
                foodCell.style.transform = 'scale(0)';
                setTimeout(() => {
                    if (foodCell) {
                        foodCell.style.transform = 'scale(0.8)';
                    }
                }, 50);
            }
        }
        
        // 改变方向
        function changeDirection(direction) {
            if (!gameState.isRunning || gameState.isPaused) return;
            
            switch (direction) {
                case 'up':
                    if (gameState.direction !== config.directions.down) {
                        gameState.nextDirection = config.directions.up;
                    }
                    break;
                case 'down':
                    if (gameState.direction !== config.directions.up) {
                        gameState.nextDirection = config.directions.down;
                    }
                    break;
                case 'left':
                    if (gameState.direction !== config.directions.right) {
                        gameState.nextDirection = config.directions.left;
                    }
                    break;
                case 'right':
                    if (gameState.direction !== config.directions.left) {
                        gameState.nextDirection = config.directions.right;
                    }
                    break;
            }
        }
        
        // 暂停/继续游戏
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            
            if (gameState.isPaused) {
                pauseBtn.innerHTML = '<i class="fa fa-play mr-1"></i>继续';
                pauseBtn.classList.remove('bg-gray-700');
                pauseBtn.classList.add('bg-secondary');
                
                // 添加暂停效果
                gameGrid.classList.add('opacity-70');
            } else {
                pauseBtn.innerHTML = '<i class="fa fa-pause mr-1"></i>暂停';
                pauseBtn.classList.remove('bg-secondary');
                pauseBtn.classList.add('bg-gray-700');
                
                // 移除暂停效果
                gameGrid.classList.remove('opacity-70');
            }
        }
        
        // 结束游戏
        function endGame() {
            // 停止游戏循环
            clearInterval(gameState.gameLoop);
            gameState.isRunning = false;
            
            // 更新最高分
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                saveHighScore();
            }
            
            // 更新结束界面
            finalScoreElement.textContent = gameState.score;
            finalHighScoreElement.textContent = gameState.highScore;
            
            // 显示结束界面和开始按钮
            gameOverOverlay.classList.remove('hidden');
            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
            
            // 游戏结束动画
            gameState.snake.forEach((segment, index) => {
                setTimeout(() => {
                    const cell = document.querySelector(`[data-x="${segment.x}"][data-y="${segment.y}"]`);
                    if (cell) {
                        cell.style.opacity = '0';
                        cell.style.transform = 'scale(0.5)';
                    }
                }, index * 30);
            });
        }
        
        // 重新开始游戏
        function restartGame() {
            startGame();
        }
        
        // 更新分数显示
        function updateScoreDisplay() {
            scoreElement.textContent = gameState.score;
            
            // 分数变化动画
            scoreElement.style.transform = 'scale(1.5)';
            setTimeout(() => {
                scoreElement.style.transform = 'scale(1)';
            }, 150);
        }
        
        // 加载最高分
        function loadHighScore() {
            const savedHighScore = localStorage.getItem('mobileSnakeHighScore');
            gameState.highScore = savedHighScore ? parseInt(savedHighScore) : 0;
            highScoreElement.textContent = gameState.highScore;
        }
        
        // 保存最高分
        function saveHighScore() {
            localStorage.setItem('mobileSnakeHighScore', gameState.highScore);
            highScoreElement.textContent = gameState.highScore;
        }
        
        // 防止页面滚动
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
        
        // 初始化游戏
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
