<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>现代贪吃蛇 | 经典游戏重制版</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- GSAP 动画库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        dark: '#111827',
                        light: '#F9FAFB',
                        snake: '#10B981',
                        food: '#EF4444',
                        grid: '#374151'
                    },
                    fontFamily: {
                        game: ['"Press Start 2P"', 'system-ui', 'sans-serif'],
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'game': '0 0 30px rgba(79, 70, 229, 0.3), 0 4px 6px -1px rgba(0, 0, 0, 0.1)',
                        'btn': '0 4px 6px -1px rgba(79, 70, 229, 0.2), 0 2px 4px -1px rgba(79, 70, 229, 0.1)',
                        'btn-hover': '0 10px 15px -3px rgba(79, 70, 229, 0.3), 0 4px 6px -2px rgba(79, 70, 229, 0.15)',
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .game-container {
                position: relative;
                max-width: 600px;
                margin: 0 auto;
            }
            
            .snake-grid {
                display: grid;
                grid-template-columns: repeat(var(--grid-cols), 1fr);
                grid-template-rows: repeat(var(--grid-rows), 1fr);
                gap: 1px;
                background-color: theme('colors.grid');
                border-radius: 6px;
                overflow: hidden;
                touch-action: none;
            }
            
            .grid-cell {
                background-color: theme('colors.dark');
                transition: background-color 0.1s ease;
            }
            
            .snake-cell {
                background-color: theme('colors.snake');
                border-radius: 3px;
                transform: scale(0.95);
                box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
                transition: all 0.08s ease;
            }
            
            .food-cell {
                background-color: theme('colors.food');
                border-radius: 50%;
                transform: scale(0.8);
                box-shadow: 0 0 10px rgba(239, 68, 68, 0.6);
                animation: pulse 1.5s infinite alternate;
            }
            
            .game-overlay {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(17, 24, 39, 0.9);
                backdrop-filter: blur(4px);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                border-radius: 6px;
                z-index: 10;
            }
            
            .score-display {
                position: relative;
                overflow: hidden;
            }
            
            .score-number {
                display: inline-block;
                min-width: 40px;
                text-align: center;
            }
            
            .direction-pad {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
                width: 180px;
                margin: 0 auto;
            }
            
            .dir-btn {
                aspect-ratio: 1/1;
                border-radius: 8px;
                background-color: rgba(79, 70, 229, 0.2);
                color: theme('colors.light');
                border: 2px solid theme('colors.primary');
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 1.5rem;
            }
            
            .dir-btn.active {
                background-color: theme('colors.primary');
                transform: scale(0.95);
                box-shadow: 0 0 15px rgba(79, 70, 229, 0.5);
            }
            
            .difficulty-btn {
                transition: all 0.2s ease;
            }
            
            .difficulty-btn.active {
                background-color: theme('colors.primary');
                color: white;
                transform: scale(1.05);
            }
            
            @keyframes pulse {
                0% { transform: scale(0.8); opacity: 0.8; }
                100% { transform: scale(0.9); opacity: 1; }
            }
            
            @keyframes slideIn {
                0% { transform: translateY(30px); opacity: 0; }
                100% { transform: translateY(0); opacity: 1; }
            }
            
            @keyframes flash {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }
            
            .animate-slide-in {
                animation: slideIn 0.5s ease forwards;
            }
            
            .animate-flash {
                animation: flash 0.5s ease infinite;
            }
            
            .snake-head {
                background-color: #059669;
                transform: scale(1);
                border-radius: 4px;
            }
            
            @media (max-width: 640px) {
                .snake-grid {
                    --grid-cols: 15;
                    --grid-rows: 15;
                }
                
                .game-container {
                    padding: 0 10px;
                }
            }
            
            @media (min-width: 641px) {
                .snake-grid {
                    --grid-cols: 20;
                    --grid-rows: 20;
                }
            }
        }
    </style>
    
    <!-- 引入像素字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-dark to-gray-900 min-h-screen text-light font-sans">
    <header class="py-6 px-4 text-center">
        <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-game text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary mb-2">
            贪吃蛇大作战
        </h1>
        <p class="text-gray-400 max-w-md mx-auto">
            控制蛇吃掉食物，不断成长！小心不要撞到自己或边界
        </p>
    </header>
    
    <main class="container mx-auto px-4 pb-16">
        <div class="game-container">
            <!-- 游戏信息栏 -->
            <div class="flex justify-between items-center mb-4 p-3 bg-gray-800/50 rounded-lg">
                <div class="score-display">
                    <span class="text-gray-400 mr-2">分数:</span>
                    <span id="score" class="score-number font-bold text-accent">0</span>
                </div>
                
                <div class="flex gap-2">
                    <button id="startBtn" class="px-4 py-2 bg-primary text-white rounded-lg font-medium shadow-btn hover:shadow-btn-hover transition-all">
                        <i class="fa fa-play mr-2"></i>开始游戏
                    </button>
                    <button id="pauseBtn" class="px-4 py-2 bg-gray-700 text-white rounded-lg font-medium shadow-btn hover:bg-gray-600 transition-all hidden">
                        <i class="fa fa-pause mr-2"></i>暂停
                    </button>
                </div>
                
                <div class="score-display">
                    <span class="text-gray-400 mr-2">最高分:</span>
                    <span id="highScore" class="score-number font-bold text-secondary">0</span>
                </div>
            </div>
            
            <!-- 游戏网格 -->
            <div id="gameGrid" class="snake-grid aspect-square w-full shadow-game"></div>
            
            <!-- 游戏开始界面 -->
            <div id="startOverlay" class="game-overlay">
                <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-game text-primary mb-6 animate-slide-in">贪吃蛇大作战</h2>
                <div class="w-full max-w-xs mx-auto mb-8 animate-slide-in" style="animation-delay: 0.1s">
                    <h3 class="text-lg font-medium mb-3 text-gray-300">选择难度</h3>
                    <div class="flex gap-3">
                        <button class="difficulty-btn active px-4 py-2 rounded-lg bg-gray-700" data-speed="150">
                            简单
                        </button>
                        <button class="difficulty-btn px-4 py-2 rounded-lg bg-gray-700" data-speed="100">
                            中等
                        </button>
                        <button class="difficulty-btn px-4 py-2 rounded-lg bg-gray-700" data-speed="70">
                            困难
                        </button>
                    </div>
                </div>
                <button id="startGameBtn" class="px-6 py-3 bg-primary text-white rounded-lg font-medium shadow-btn hover:shadow-btn-hover transition-all text-lg animate-slide-in" style="animation-delay: 0.2s">
                    <i class="fa fa-play mr-2"></i>开始游戏
                </button>
                <p class="mt-6 text-gray-400 animate-slide-in" style="animation-delay: 0.3s">
                    电脑: 方向键控制 | 手机: 触摸方向键
                </p>
            </div>
            
            <!-- 游戏结束界面 -->
            <div id="gameOverOverlay" class="game-overlay hidden">
                <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-game text-food mb-4 animate-slide-in">游戏结束!</h2>
                <p class="text-xl mb-2 text-gray-300 animate-slide-in" style="animation-delay: 0.1s">
                    最终得分: <span id="finalScore" class="text-accent font-bold">0</span>
                </p>
                <p class="text-xl mb-8 text-gray-300 animate-slide-in" style="animation-delay: 0.2s">
                    最高分: <span id="finalHighScore" class="text-secondary font-bold">0</span>
                </p>
                <button id="restartBtn" class="px-6 py-3 bg-primary text-white rounded-lg font-medium shadow-btn hover:shadow-btn-hover transition-all text-lg animate-slide-in" style="animation-delay: 0.3s">
                    <i class="fa fa-refresh mr-2"></i>再来一局
                </button>
            </div>
        </div>
        
        <!-- 移动端方向键 -->
        <div class="md:hidden mt-8">
            <div class="direction-pad">
                <div></div>
                <button class="dir-btn" data-direction="up">
                    <i class="fa fa-chevron-up"></i>
                </button>
                <div></div>
                <button class="dir-btn" data-direction="left">
                    <i class="fa fa-chevron-left"></i>
                </button>
                <div></div>
                <button class="dir-btn" data-direction="right">
                    <i class="fa fa-chevron-right"></i>
                </button>
                <div></div>
                <button class="dir-btn" data-direction="down">
                    <i class="fa fa-chevron-down"></i>
                </button>
                <div></div>
            </div>
        </div>
    </main>
    
    <footer class="py-6 text-center text-gray-500 text-sm">
        <p>© 2025 贪吃蛇大作战 | 经典游戏重制版</p>
    </footer>

    <script>
        // 游戏配置
        const config = {
            gridSize: {
                mobile: 15,
                desktop: 20
            },
            initialSpeed: 150, // 毫秒/步
            directions: {
                up: { x: 0, y: -1 },
                down: { x: 0, y: 1 },
                left: { x: -1, y: 0 },
                right: { x: 1, y: 0 }
            }
        };
        
        // 游戏状态
        let gameState = {
            snake: [],
            food: {},
            direction: config.directions.right,
            nextDirection: config.directions.right,
            isRunning: false,
            isPaused: false,
            score: 0,
            highScore: 0,
            speed: config.initialSpeed,
            gridSize: 0,
            gameLoop: null
        };
        
        // DOM元素
        const gameGrid = document.getElementById('gameGrid');
        const startOverlay = document.getElementById('startOverlay');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const restartBtn = document.getElementById('restartBtn');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const finalScoreElement = document.getElementById('finalScore');
        const finalHighScoreElement = document.getElementById('finalHighScore');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        const directionBtns = document.querySelectorAll('.dir-btn');
        
        // 初始化游戏
        function initGame() {
            // 检测设备类型，设置网格大小
            const isMobile = window.innerWidth <= 640;
            gameState.gridSize = isMobile ? config.gridSize.mobile : config.gridSize.desktop;
            
            // 设置CSS变量
            gameGrid.style.setProperty('--grid-cols', gameState.gridSize);
            gameGrid.style.setProperty('--grid-rows', gameState.gridSize);
            
            // 创建网格单元格
            gameGrid.innerHTML = '';
            for (let y = 0; y < gameState.gridSize; y++) {
                for (let x = 0; x < gameState.gridSize; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    gameGrid.appendChild(cell);
                }
            }
            
            // 加载最高分
            loadHighScore();
            
            // 添加事件监听
            setupEventListeners();
        }
        
        // 设置事件监听
        function setupEventListeners() {
            // 桌面端方向键控制
            document.addEventListener('keydown', handleKeyDown);
            
            // 移动端方向键控制
            directionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const direction = btn.dataset.direction;
                    changeDirection(direction);
                    
                    // 添加点击动画
                    btn.classList.add('active');
                    setTimeout(() => btn.classList.remove('active'), 100);
                });
            });
            
            // 难度选择
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    difficultyBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    gameState.speed = parseInt(btn.dataset.speed);
                });
            });
            
            // 按钮事件
            startBtn.addEventListener('click', startGame);
            pauseBtn.addEventListener('click', togglePause);
            startGameBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', restartGame);
        }
        
        // 开始游戏
        function startGame() {
            // 重置游戏状态
            resetGame();
            
            // 隐藏覆盖层，显示暂停按钮
            startOverlay.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');
            startBtn.classList.add('hidden');
            pauseBtn.classList.remove('hidden');
            
            // 开始游戏循环
            gameState.isRunning = true;
            gameState.isPaused = false;
            startGameLoop();
            
            // 动画效果
            gsap.from('.snake-cell', {
                scale: 0,
                opacity: 0,
                stagger: 0.02,
                duration: 0.3,
                ease: 'elastic.out'
            });
        }
        
        // 重置游戏
        function resetGame() {
            // 清除之前的游戏循环
            if (gameState.gameLoop) {
                clearInterval(gameState.gameLoop);
            }
            
            // 重置分数
            gameState.score = 0;
            updateScoreDisplay();
            
            // 初始化蛇的位置（居中）
            const centerX = Math.floor(gameState.gridSize / 2);
            const centerY = Math.floor(gameState.gridSize / 2);
            
            gameState.snake = [
                { x: centerX, y: centerY },
                { x: centerX - 1, y: centerY },
                { x: centerX - 2, y: centerY }
            ];
            
            // 初始方向
            gameState.direction = config.directions.right;
            gameState.nextDirection = config.directions.right;
            
            // 生成食物
            generateFood();
            
            // 更新游戏网格
            updateGameGrid();
        }
        
        // 开始游戏循环
        function startGameLoop() {
            gameState.gameLoop = setInterval(() => {
                if (!gameState.isPaused) {
                    moveSnake();
                }
            }, gameState.speed);
        }
        
        // 移动蛇
        function moveSnake() {
            // 更新方向
            gameState.direction = gameState.nextDirection;
            
            // 计算新的蛇头位置
            const head = { ...gameState.snake[0] };
            head.x += gameState.direction.x;
            head.y += gameState.direction.y;
            
            // 检测碰撞
            if (checkCollision(head)) {
                endGame();
                return;
            }
            
            // 将新蛇头添加到蛇的前面
            gameState.snake.unshift(head);
            
            // 检查是否吃到食物
            if (head.x === gameState.food.x && head.y === gameState.food.y) {
                // 吃到食物，加分并生成新食物
                gameState.score += 10;
                updateScoreDisplay();
                generateFood();
                
                // 播放吃食物动画
                const foodCell = document.querySelector(`[data-x="${gameState.food.x}"][data-y="${gameState.food.y}"]`);
                if (foodCell) {
                    gsap.to(foodCell, {
                        scale: 1.5,
                        opacity: 0,
                        duration: 0.2,
                        ease: 'back.in'
                    });
                }
            } else {
                // 没吃到食物，移除蛇尾
                gameState.snake.pop();
            }
            
            // 更新游戏网格
            updateGameGrid();
        }
        
        // 检测碰撞
        function checkCollision(head) {
            // 边界碰撞
            if (
                head.x < 0 || 
                head.x >= gameState.gridSize || 
                head.y < 0 || 
                head.y >= gameState.gridSize
            ) {
                return true;
            }
            
            // 自身碰撞
            for (let i = 0; i < gameState.snake.length; i++) {
                if (head.x === gameState.snake[i].x && head.y === gameState.snake[i].y) {
                    return true;
                }
            }
            
            return false;
        }
        
        // 生成食物
        function generateFood() {
            let foodX, foodY;
            let isOnSnake;
            
            // 确保食物不在蛇身上
            do {
                isOnSnake = false;
                foodX = Math.floor(Math.random() * gameState.gridSize);
                foodY = Math.floor(Math.random() * gameState.gridSize);
                
                // 检查食物是否在蛇身上
                for (let i = 0; i < gameState.snake.length; i++) {
                    if (gameState.snake[i].x === foodX && gameState.snake[i].y === foodY) {
                        isOnSnake = true;
                        break;
                    }
                }
            } while (isOnSnake);
            
            gameState.food = { x: foodX, y: foodY };
        }
        
        // 更新游戏网格
        function updateGameGrid() {
            // 清除所有单元格状态
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('snake-cell', 'food-cell', 'snake-head');
            });
            
            // 更新蛇的位置
            gameState.snake.forEach((segment, index) => {
                const cell = document.querySelector(`[data-x="${segment.x}"][data-y="${segment.y}"]`);
                if (cell) {
                    cell.classList.add('snake-cell');
                    // 标记蛇头
                    if (index === 0) {
                        cell.classList.add('snake-head');
                    }
                }
            });
            
            // 更新食物位置
            const foodCell = document.querySelector(`[data-x="${gameState.food.x}"][data-y="${gameState.food.y}"]`);
            if (foodCell) {
                foodCell.classList.add('food-cell');
                
                // 食物出现动画
                gsap.from(foodCell, {
                    scale: 0,
                    opacity: 0,
                    duration: 0.3,
                    ease: 'elastic.out'
                });
            }
        }
        
        // 处理键盘事件
        function handleKeyDown(e) {
            if (!gameState.isRunning) return;
            
            switch (e.key) {
                case 'ArrowUp':
                    if (gameState.direction !== config.directions.down) {
                        gameState.nextDirection = config.directions.up;
                    }
                    break;
                case 'ArrowDown':
                    if (gameState.direction !== config.directions.up) {
                        gameState.nextDirection = config.directions.down;
                    }
                    break;
                case 'ArrowLeft':
                    if (gameState.direction !== config.directions.right) {
                        gameState.nextDirection = config.directions.left;
                    }
                    break;
                case 'ArrowRight':
                    if (gameState.direction !== config.directions.left) {
                        gameState.nextDirection = config.directions.right;
                    }
                    break;
                case ' ': // 空格键暂停/继续
                    togglePause();
                    break;
            }
        }
        
        // 改变方向（移动端）
        function changeDirection(direction) {
            if (!gameState.isRunning || gameState.isPaused) return;
            
            switch (direction) {
                case 'up':
                    if (gameState.direction !== config.directions.down) {
                        gameState.nextDirection = config.directions.up;
                    }
                    break;
                case 'down':
                    if (gameState.direction !== config.directions.up) {
                        gameState.nextDirection = config.directions.down;
                    }
                    break;
                case 'left':
                    if (gameState.direction !== config.directions.right) {
                        gameState.nextDirection = config.directions.left;
                    }
                    break;
                case 'right':
                    if (gameState.direction !== config.directions.left) {
                        gameState.nextDirection = config.directions.right;
                    }
                    break;
            }
        }
        
        // 暂停/继续游戏
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            
            if (gameState.isPaused) {
                pauseBtn.innerHTML = '<i class="fa fa-play mr-2"></i>继续';
                pauseBtn.classList.remove('bg-gray-700');
                pauseBtn.classList.add('bg-secondary');
                
                // 添加暂停效果
                gameGrid.classList.add('opacity-70');
            } else {
                pauseBtn.innerHTML = '<i class="fa fa-pause mr-2"></i>暂停';
                pauseBtn.classList.remove('bg-secondary');
                pauseBtn.classList.add('bg-gray-700');
                
                // 移除暂停效果
                gameGrid.classList.remove('opacity-70');
            }
        }
        
        // 结束游戏
        function endGame() {
            // 停止游戏循环
            clearInterval(gameState.gameLoop);
            gameState.isRunning = false;
            
            // 更新最高分
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                saveHighScore();
            }
            
            // 更新结束界面
            finalScoreElement.textContent = gameState.score;
            finalHighScoreElement.textContent = gameState.highScore;
            
            // 显示结束界面和开始按钮
            gameOverOverlay.classList.remove('hidden');
            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
            
            // 游戏结束动画
            gsap.to('.snake-cell', {
                scale: 0,
                opacity: 0,
                stagger: 0.02,
                duration: 0.2,
                ease: 'back.in'
            });
            
            // 闪烁效果
            const headCell = document.querySelector(`[data-x="${gameState.snake[0].x}"][data-y="${gameState.snake[0].y}"]`);
            if (headCell) {
                headCell.classList.add('animate-flash');
            }
        }
        
        // 重新开始游戏
        function restartGame() {
            startGame();
        }
        
        // 更新分数显示
        function updateScoreDisplay() {
            scoreElement.textContent = gameState.score;
            highScoreElement.textContent = gameState.highScore;
            
            // 添加分数变化动画
            gsap.from(scoreElement, {
                scale: 1.5,
                duration: 0.2,
                ease: 'elastic.out'
            });
        }
        
        // 加载最高分
        function loadHighScore() {
            const savedHighScore = localStorage.getItem('snakeHighScore');
            gameState.highScore = savedHighScore ? parseInt(savedHighScore) : 0;
            highScoreElement.textContent = gameState.highScore;
        }
        
        // 保存最高分
        function saveHighScore() {
            localStorage.setItem('snakeHighScore', gameState.highScore);
        }
        
        // 窗口大小变化时重新初始化游戏
        window.addEventListener('resize', () => {
            if (!gameState.isRunning) {
                initGame();
            }
        });
        
        // 初始化游戏
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            
            // 页面加载动画
            gsap.from('header', {
                opacity: 0,
                y: -20,
                duration: 0.8
            });
            
            gsap.from('.game-container', {
                opacity: 0,
                y: 20,
                duration: 0.8,
                delay: 0.2
            });
            
            gsap.from('footer', {
                opacity: 0,
                y: 20,
                duration: 0.8,
                delay: 0.4
            });
        });
    </script>
</body>
</html>
